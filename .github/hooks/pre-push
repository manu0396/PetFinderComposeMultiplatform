#!/bin/sh

set -e

echo "--- Starting Integrity Audit ---"

GIT_ROOT=$(git rev-parse --show-toplevel)
cd "$GIT_ROOT"

if [ -f "./verify-build.sh" ]; then
    echo "Executing integral build verification..."
    ./verify-build.sh
else
    echo "ERROR: verify-build.sh not found at project root ($GIT_ROOT)."
    exit 1
fi

RESULT=$?
if [ $RESULT -ne 0 ]; then
    echo "ERROR: Build verification failed. Push aborted."
    exit 1
fi

echo "Integrity check passed. Proceeding with push."
exit 0
